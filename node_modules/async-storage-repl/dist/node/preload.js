'use strict';

require('babel-register');
var spawn = require('child_process').spawn;
var path = require('path');
var Storage = require('./RNAsyncStorage');

global.RNAsyncStorage = new Storage();
global._ayncStorageWebSocketServer = spawn('node', [path.join(__dirname, 'server.js')], {
  stdio: ['inherit', 'inherit', 'inherit', 'ipc'],
  env: process.env
});

process.on('exit', function () {
  global.RNAsyncStorage._exit();
  global._ayncStorageWebSocketServer.send('exit');
});

process.on('SIGINT', function () {
  process.exit();
});

process.on('SIGTERM', function () {
  process.exit();
});